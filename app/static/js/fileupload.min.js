function doUpload(){$("#progress").show();var t=$("#progress-bar");$("#upload-form :input").attr("disabled","disabled"),t.css({width:"0%"}),fd=collectFormData();for(var e=0,a=PENDING_FILES.length;a>e;e++)fd.append("files[]",PENDING_FILES[e]);fd.append("__ajax","true");$.ajax({xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){var a=0,n=e.loaded||e.position,o=e.total;e.lengthComputable&&(a=Math.ceil(n/o*100)),t.css({width:a+"%"}),t.text(a+"%")},!1),e},url:UPLOAD_URL,method:"POST",contentType:!1,processData:!1,cache:!1,data:fd,success:function(e){t.css({width:"100%"}),e=JSON.parse(e),PENDING_FILES=[],$("#upload-form :input").removeAttr("disabled"),$("#uploaded").show(),updatePendingfilesText();for(var a=0;a<e.length;a++)e[a].error||$("#files-table").append('<tr>  <td><a href="'+e[a].link+'" target="_blank">/'+e[a].oid+"</a></td>  <td>"+e[a]["input-name"]+"</td>  <td>"+e[a].name+"</td>  <td>"+e[a].size+'</td>  <td>      <a href="/'+e[a].oid+'/stats" class="btn btn-default" target="_blank"><i class="icon-chart-bar"></i></a>      <a href="/'+e[a].oid+'/edit" class="btn btn-default" target="_blank"><i class="icon-edit"></i></a>      <a href="/'+e[a].oid+'/delete" class="btn btn-default btn-delete" target="_blank"><i class="icon-trash"></i></a>  </td></tr>');$(".btn-delete").click(function(t){confirm("Do you realy want to delete this item?")||t.preventDefault()})},error:function(){PENDING_FILES=[],$("#upload-form :input").removeAttr("disabled"),updatePendingfilesText(),alert("Upload failed.")}})}function updatePendingfilesText(){if(0===PENDING_FILES.length)$dropbox.text("Drag and Drop Files Here"),$("#upload-button").attr("disabled",!0);else{PENDING_FILES_UL="<ul>";for(var t=0;t<PENDING_FILES.length;t++)PENDING_FILES_UL+="<li>"+PENDING_FILES[t].name+"</li>";PENDING_FILES_UL+="</ul>",$dropbox.html(PENDING_FILES_UL),$("#upload-button").attr("disabled",!1)}}function collectFormData(){var t=new FormData;return $("#upload-form :input").each(function(){var e=$(this),a=e.attr("name"),n=e.attr("type")||"",o=e.val();void 0!==a&&"file"!==n&&("checkbox"!==n&&"radio"!==n||e.is(":checked"))&&t.append(a,o)}),t}function handleFiles(t){for(var e=0,a=t.length;a>e;e++)PENDING_FILES.push(t[e]),updatePendingfilesText()}var UPLOAD_URL=$("#upload-form").attr("action"),$dropbox=$("#dropbox"),PENDING_FILES=[];$(document).ready(function(){function t(t){t.stopPropagation(),t.preventDefault()}$dropbox.on("dragenter",function(t){t.stopPropagation(),t.preventDefault(),$(this).addClass("active")}),$dropbox.on("dragover",function(t){t.stopPropagation(),t.preventDefault()}),$dropbox.on("drop",function(t){t.preventDefault(),$(this).removeClass("active");var e=t.originalEvent.dataTransfer.files;handleFiles(e),updatePendingfilesText()}),$(document).on("dragenter",t),$(document).on("dragover",t),$(document).on("drop",t),$dropbox.click(function(){$("input[type='file']").trigger("click")}),$("#file-picker").hide(),$("#file-picker").on("change",function(){handleFiles(this.files)}),$("#upload-button").on("click",function(t){t.preventDefault(),doUpload()})});